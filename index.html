<!DOCTYPE html>
<html>
<head>
    <title>Отправка транзакции через MetaMask</title>
</head>
<body>
    <h1>Отправка транзакции через MetaMask</h1>

    <!-- Подключение актуальной версии web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>

    <input type="text" id="toAddressInput" placeholder="Адрес получателя">
    <input type="number" id="amountInput" step="0.0001" placeholder="Сумма для отправки (в MATIC)">
    <button onclick="sendTransaction()">Отправить</button>

    <script>
        // Проверка наличия MetaMask
        async function checkMetaMaskAvailability() {
            if (window.ethereum && window.ethereum.isMetaMask) {
                try {
                    // Запрос на подключение к MetaMask
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    console.log('MetaMask доступен!');
                } catch (error) {
                    console.error('Ошибка подключения к MetaMask:', error);
                }
            } else {
                console.error('MetaMask не найден или не установлен.');
            }
        }

        // Отправка транзакции
        async function sendTransaction() {
            const toAddressInput = document.getElementById('toAddressInput');
            const amountInput = document.getElementById('amountInput');
            const toAddress = toAddressInput.value;
            const amountMatic = amountInput.value;

            try {
                // Получение аккаунта MetaMask
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                const account = accounts[0];

                // Создание экземпляра web3
                const web3 = new Web3(window.ethereum);

                // Получение текущей средней стоимости газа
                const gasPrice = await web3.eth.getGasPrice();

                // Преобразование суммы из MATIC в wei
                const maticToWei = web3.utils.toWei(amountMatic, 'ether');

                // Создание транзакции с автоматически выставленной стоимостью газа
                const transactionObject = {
                    from: account,
                    to: toAddress,
                    value: maticToWei,
                    gasPrice: gasPrice
                };

                // Отправка транзакции
                const transactionHash = await web3.eth.sendTransaction(transactionObject);
                console.log('Транзакция успешно отправлена:', transactionHash);
            } catch (error) {
                console.error('Ошибка отправки транзакции:', error);
            }
        }

        // Проверка доступности MetaMask и выполнение инициализации
        checkMetaMaskAvailability();
    </script>
</body>
</html>
